{% extends 'mondongo/base.html' %} 
{% block title %}Posts - Mondongo{%endblock%} 
{% block header %}Gestionar Posts{% endblock %} 
{% block content %}
<div class="card">
  <div
    style="
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    "
  >
    <form
      method="get"
      style="display: flex; gap: 10px; align-items: center; width: 100%"
    >
      <input
        type="text"
        name="q"
        placeholder="Buscar por contenido, autor..."
        value="{{ request.GET.q|default:'' }}"
        style="
          padding: 8px;
          border: 1px solid #ddd;
          border-radius: 4px;
          flex: 1;
        "
      />
      <input
        type="date"
        name="date"
        value="{{ request.GET.date|default:'' }}"
        style="padding: 8px; border: 1px solid #ddd; border-radius: 4px"
        title="Filtrar por fecha"
      />
      <button type="submit" class="btn-action btn-success">Filtrar</button>
    </form>
  </div>
  <table>
    <thead>
      <tr>
        <th>Autor</th>
        <th>Contenido</th>
        <th>Imagen</th>
        <th>Fecha</th>
        <th>Likes</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      {% for post in posts %}
      <tr>
        <td>{{ post.author.user.username }}</td>
        <td>{{ post.content|truncatechars:50 }}</td>
        <td>
          {% if post.image %}
          <img
            src="{{ post.image.url }}"
            alt=""
            style="width: 50px; height: 50px; object-fit: cover"
          />
          {% else %}
          <span style="color: #ccc">-</span>
          {% endif %}
        </td>
        <td>{{ post.created_at|date:"d M Y H:i" }}</td>
        <td>{{ post.likes_count }}</td>
        <td>
          <form
            action="{% url 'mondongo_post_delete' post.pk %}"
            method="post"
            style="display: inline"
          >
            {% csrf_token %}
            <button
              type="submit"
              class="btn-action btn-danger"
              onclick="
                return confirm(
                  '¿Estás seguro de eliminar este post permanentemente?',
                );
              "
            >
              Eliminar
            </button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" style="text-align: center; padding: 20px">
          No hay posts.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if is_paginated %}
  <div class="pagination">
    {% if page_obj.has_previous %}
    <a
      href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.date %}&date={{ request.GET.date }}{% endif %}"
      class="page-link"
      >← Anterior</a
    >
    {% endif %}

    <span style="padding: 8px 16px"
      >Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span
    >

    {% if page_obj.has_next %}
    <a
      href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.date %}&date={{ request.GET.date }}{% endif %}"
      class="page-link"
      >Siguiente →</a
    >
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
